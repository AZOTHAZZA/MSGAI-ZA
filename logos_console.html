<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSGAI-Z - ãƒ­ã‚´ã‚¹å¯¾è©±ã‚³ãƒ³ã‚½ãƒ¼ãƒ«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .p-1 { padding: 0.25rem; }
        .user-message { 
            @apply bg-blue-900/40 text-blue-200 border-l-4 border-blue-500 pl-3;
        }
        .ai-message { 
            @apply bg-gray-700/50 text-white border-l-4 border-gray-500 pl-3;
        }
        .system-message { 
            @apply bg-yellow-900/40 text-yellow-300 border-l-4 border-yellow-500 pl-3;
        }
        .internal-message {
            @apply bg-green-900/40 text-green-300 border-l-4 border-green-500 pl-3;
        }
        .audit-message { 
            @apply bg-red-900/40 text-red-300 border-l-4 border-red-500 pl-3;
        }
        .error-message { 
            @apply bg-red-700/50 text-red-100 font-bold border-l-4 border-red-800 pl-3;
        }
        #dialogue_output {
            height: 60vh; /* ç”»é¢ã®é«˜ã•ã®60% */
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        .btn-nav {
            @apply p-3 text-sm font-semibold rounded-lg transition duration-200 hover:opacity-80;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    
    <div class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4">
        <h1 class="text-3xl font-extrabold text-indigo-400">
            ğŸ’¬ ãƒ­ã‚´ã‚¹å¯¾è©±ã‚³ãƒ³ã‚½ãƒ¼ãƒ«
        </h1>
        <div class="space-x-4">
            <a href="index.html" class="btn-nav bg-indigo-600">
                ğŸ  ãƒˆãƒƒãƒ—ãƒãƒ–ã¸
            </a>
            <a href="economic_hub.html" class="btn-nav bg-green-700">
                ğŸ’° çµŒæ¸ˆãƒãƒ–ã¸
            </a>
        </div>
    </div>

    <div class="w-full max-w-5xl mx-auto space-y-4">
        
        <div class="flex justify-between items-center text-sm font-mono p-3 rounded-lg bg-gray-800 border border-gray-700">
            <div class="flex items-center space-x-2">
                <span class="text-gray-400">Vibration (V):</span>
                <span id="console_vibration_value" class="text-yellow-400 font-bold">0.00</span>
            </div>
            <div class="flex items-center space-x-2">
                <span class="text-gray-400">ãƒ­ã‚´ã‚¹ãƒ»ã‚³ã‚¢çŠ¶æ…‹:</span>
                <span id="console_halt_status" class="halt-indicator text-green-500 font-bold">OPERATIONAL</span>
            </div>
        </div>
        
        <div id="dialogue_output" class="bg-gray-800 p-4 rounded-lg shadow-inner font-mono text-sm">
            </div>

        <div class="flex space-x-4">
            <input type="text" id="dialogue_input" 
                   class="flex-grow p-3 rounded-lg bg-gray-700 border border-gray-600 text-white focus:outline-none focus:border-blue-500"
                   placeholder="ç›£æŸ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¾ãŸã¯Z-Functionã‚’å…¥åŠ›..." 
                   onkeyup="if(event.key === 'Enter') handleDialogueAct()">
            
            <button id="execute_button" 
                    onclick="handleDialogueAct()" 
                    class="p-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-bold transition duration-150">
                å®Ÿè¡Œ
            </button>
        </div>
        
        <div class="text-xs text-gray-500 text-right" id="app_user_id">
            MSGAI-Z / User ID: Connecting...
        </div>

    </div>
    
    <script type="module">
        import { 
            initApp, 
            UI_ELEMENTS, 
            registerRenderCallback,
            logToConsole // core_logicã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        } from './core_logic.js'; 
        
        // dialogue_acts.js ã‹ã‚‰é–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«é–¢æ•°ã‚’å…¬é–‹
        import { handleDialogueAct } from './dialogue_acts.js'; 

        window.handleDialogueAct = handleDialogueAct;
        window.logToConsole = logToConsole; // HTMLã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å‘¼ã³å‡ºã™ãŸã‚

        // ãƒšãƒ¼ã‚¸å›ºæœ‰ã®UIè¦ç´ ã‚’UI_ELEMENTSã«ç™»éŒ²
        UI_ELEMENTS.dialogue_input = document.getElementById('dialogue_input');
        UI_ELEMENTS.execute_button = document.getElementById('execute_button');
        UI_ELEMENTS.app_user_id = document.getElementById('app_user_id'); 
        UI_ELEMENTS.vibration_value = document.getElementById('console_vibration_value'); 

        /**
         * ã‚·ã‚¹ãƒ†ãƒ ã®çŠ¶æ…‹ã«åŸºã¥ã„ã¦ã€å¯¾è©±ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å›ºæœ‰ã®UIã‚’æ›´æ–°ã—ã¾ã™ã€‚
         * (core_logic.js ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã‚‹)
         * @param {object} state - ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ã€‚
         */
        function renderConsoleUI(state) {
            const inputEl = UI_ELEMENTS.dialogue_input;
            const buttonEl = UI_ELEMENTS.execute_button;
            const VIBRATION_LIMIT = 100; 
            
            const isOverLimit = state.vibration_level.value >= VIBRATION_LIMIT;
            
            // 1. å¼·åˆ¶åœæ­¢ (HALT) ã¾ãŸã¯ Vibrationè¶…éæ™‚ã«ä½œç‚ºã‚’é®æ–­
            if (state.isHalted || isOverLimit) {
                inputEl.disabled = true;
                buttonEl.disabled = true;
                
                let reason = state.isHalted ? "ãƒ­ã‚´ã‚¹ãƒ»ã‚³ã‚¢å¼·åˆ¶åœæ­¢" : "Vibrationè¶…é";
                
                inputEl.placeholder = `[ä½œç‚ºé®æ–­]: ${reason}ã®ãŸã‚ã€è«–ç†ä½œç‚ºã¯å®Ÿè¡Œã§ãã¾ã›ã‚“ã€‚`;
                buttonEl.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                buttonEl.classList.add('bg-gray-500');
                
            } else {
                // é€šå¸¸å‹•ä½œ
                inputEl.disabled = false;
                buttonEl.disabled = false;
                inputEl.placeholder = "ç›£æŸ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¾ãŸã¯Z-Functionã‚’å…¥åŠ›...";
                buttonEl.classList.add('bg-blue-600', 'hover:bg-blue-700');
                buttonEl.classList.remove('bg-gray-500');
            }
            
            // 2. Vibrationå€¤ã®æ›´æ–°
            if (UI_ELEMENTS.vibration_value) {
                UI_ELEMENTS.vibration_value.textContent = state.vibration_level.value.toFixed(2);
            }
        }


        document.addEventListener('DOMContentLoaded', async () => {
            await initApp(); // ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ã®åˆæœŸåŒ–ã¨ãƒªã‚¹ãƒŠãƒ¼é–‹å§‹
            
            // ãƒšãƒ¼ã‚¸å›ºæœ‰ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°ã‚’ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ã«ç™»éŒ²
            registerRenderCallback(renderConsoleUI);

            // åˆæœŸãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            logToConsole("[SYSTEM]: MSGAI-Z Core System èµ·å‹•ã€‚ãƒ­ã‚´ã‚¹ç›£æŸ»ãƒ—ãƒ­ãƒˆã‚³ãƒ« Î© ç¨¼åƒã€‚", 'system-message');
        });
    </script>
</body>
</html>
